<script setup>
import { ref, computed, onMounted } from 'vue';
import { doc, getDoc } from 'firebase/firestore';
import { db } from '@/services/firebase-firestore';
import { useRoute, useRouter } from 'vue-router';
import Button from '@/components/Button.vue';

const route = useRoute();
const router = useRouter();
const quiz = ref(null);

onMounted(async () => {
  const userId = localStorage.getItem('bdb.userId');
  const docSnap = await getDoc(doc(db, 'users', userId));  
  const user = docSnap.exists() ? docSnap.data() : null;

  quiz.value = user.quizzes.find(quiz => quiz.id === Number(route.params.id));
});

const message = computed(() => {
  switch (true) {
  case quiz.value.score >= 0 && quiz.value.score <= 4:
    return 'Que pena...';
  case quiz.value.score >= 5 && quiz.value.score <= 8:
    return 'Ã‰ isso aÃ­!';
  case quiz.value.score == 9:
    return 'Muito bem!';
  case quiz.value.score == 10:
    return 'ParabÃ©ns';
  default:
    return 'Nota nÃ£o especificada nos intervalos.';
  }
});

const emoji = computed(() => {
  switch (true) {
  case quiz.value.score >= 0 && quiz.value.score <= 4:
    return 'ðŸ˜•';
  case quiz.value.score >= 5 && quiz.value.score <= 8:
    return 'ðŸ˜Š';
  case quiz.value.score == 9:
    return 'ðŸ¤©';
  case quiz.value.score == 10:
    return 'ðŸ¥³';
  default:
    return 'Nota nÃ£o especificada nos intervalos.';
  }
});
</script>

<template>
  <div
    v-if="quiz"
    class="flex flex-col items-center gap-3 p-7 min-h-screen"
  >
    <div class="text-9xl mt-10">
      {{ emoji }}
    </div>

    <div class="flex-1 text-5xl text-center font-extrabold leading-tight">
      {{ message }} VocÃª tirou <span class="text-success">Nota {{ quiz.score }}</span>
    </div>

    <Button
      size="block"
      text="Voltar ao inÃ­cio"
      @click="router.push('/')"
    />
  </div>
</template>